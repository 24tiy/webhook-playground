<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Webhook Events</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px}
h1{font-size:40px;margin:0 0 16px}
.tools{display:flex;gap:12px;align-items:center;margin:12px 0 20px}
input{padding:10px 12px;border:1px solid #ddd;border-radius:8px;min-width:280px}
button{padding:10px 14px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
table{border-collapse:collapse;width:100%}
th,td{border-top:1px solid #eee;padding:14px}
th{text-align:left;background:#fafafa}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee}
.x{color:#b00;font-weight:700}
.ok{color:#0a0}
.count{font-weight:600}
</style>
</head>
<body>
<h1>Webhook Events</h1>
<div class="tools">
  <div>Total: <span id="count" class="count">0</span></div>
  <input id="q" placeholder="Search (provider, id, payload)" />
  <button id="refresh">Refresh</button>
</div>
<table>
  <thead>
    <tr><th>Time</th><th>Provider</th><th>Verified</th><th>ID</th><th>Link</th></tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<script>
const rows = document.getElementById('rows');
const countEl = document.getElementById('count');
const q = document.getElementById('q');
const refreshBtn = document.getElementById('refresh');

async function load() {
  const ts = Date.now();
  const res = await fetch('./events.json?ts=' + ts, {cache: 'no-store'});
  const list = await res.json();
  render(list);
}

function match(item, needle) {
  const s = (JSON.stringify(item)||'').toLowerCase();
  return s.includes(needle.toLowerCase());
}

function render(list) {
  const needle = q.value.trim();
  const filtered = needle ? list.filter(x => match(x, needle)) : list;
  countEl.textContent = filtered.length.toString();
  rows.innerHTML = filtered.map(x => {
    const dt = new Date(x.receivedAt);
    const ok = x.verified ? 'ok' : 'x';
    return `
      <tr>
        <td>${dt.toLocaleString()}</td>
        <td><span class="badge">${x.provider}</span></td>
        <td class="${ok}">${x.verified ? '✓' : '✗'}</td>
        <td><code>${x.id}</code></td>
        <td><a href="./events/${x.id}.json" target="_blank">JSON</a></td>
      </tr>
    `;
  }).join('');
}

q.addEventListener('input', load);
refreshBtn.addEventListener('click', load);
load();
</script>
</body>
</html>
