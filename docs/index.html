<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Webhook Playground</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;margin:20px}
h1{margin:0 0 16px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
input,select{padding:8px;border:1px solid #ccc;border-radius:6px}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;font-size:14px;vertical-align:top}
.badge{display:inline-block;padding:2px 6px;border-radius:999px;font-size:12px}
.ok{background:#e8f5e9;color:#1b5e20}
.fail{background:#ffebee;color:#b71c1c}
.time{white-space:nowrap}
pre{white-space:pre-wrap;max-width:680px}
</style>
</head>
<body>
<h1>Webhook Playground</h1>
<div class="controls">
  <input id="q" placeholder="filter...">
  <select id="prov"><option value="">provider: any</option><option>stripe</option><option>paypal</option><option>adyen</option><option>debug</option></select>
  <select id="ver"><option value="">verified: any</option><option value="true">true</option><option value="false">false</option></select>
  <button id="reload">reload</button>
</div>
<table id="t">
  <thead><tr><th>time</th><th>provider</th><th>verified</th><th>id</th><th>summary</th></tr></thead>
  <tbody></tbody>
</table>
<script>
async function load() {
  const res = await fetch('events.json', {cache:'no-store'});
  const data = await res.json();
  return Array.isArray(data) ? data : [];
}
function match(row, q, prov, ver) {
  if (prov && row.provider !== prov) return false;
  if (ver && String(row.verified) !== ver) return false;
  if (!q) return true;
  const s = JSON.stringify(row).toLowerCase();
  return s.includes(q.toLowerCase());
}
function draw(rows) {
  const q = document.getElementById('q').value.trim();
  const prov = document.getElementById('prov').value.trim();
  const ver = document.getElementById('ver').value.trim();
  const body = document.querySelector('#t tbody');
  body.innerHTML = '';
  rows.filter(r => match(r,q,prov,ver)).forEach(r => {
    const tr = document.createElement('tr');
    const tdTime = document.createElement('td'); tdTime.className='time'; tdTime.textContent = r.receivedAt || ''; tr.appendChild(tdTime);
    const tdProv = document.createElement('td'); tdProv.textContent = r.provider; tr.appendChild(tdProv);
    const tdVer = document.createElement('td'); const b = document.createElement('span'); b.className='badge ' + (r.verified?'ok':'fail'); b.textContent = String(r.verified); tdVer.appendChild(b); tr.appendChild(tdVer);
    const tdId = document.createElement('td'); tdId.textContent = r.id; tr.appendChild(tdId);
    const tdSum = document.createElement('td'); const pre = document.createElement('pre'); pre.textContent = JSON.stringify(r.payload).slice(0,500); tdSum.appendChild(pre); tr.appendChild(tdSum);
    body.appendChild(tr);
  });
}
let rows = [];
async function refresh() { rows = await load(); draw(rows); }
document.getElementById('reload').onclick = refresh;
document.getElementById('q').oninput = () => draw(rows);
document.getElementById('prov').onchange = () => draw(rows);
document.getElementById('ver').onchange = () => draw(rows);
refresh();
</script>
</body>
</html>
